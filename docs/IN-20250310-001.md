---
incident_id: IN-20250310-001
occurred_at: 2025-03-10T14:15:00Z
owner: oncall-naito
status: draft
linked_pr: TBD
runbook: ../Day8/workflow-cookbook/RUNBOOK.md
blueprint: ../Day8/workflow-cookbook/BLUEPRINT.md
evaluation: ../Day8/workflow-cookbook/EVALUATION.md
severity: minor
detected_at: 2025-03-10T14:15:00Z
resolved_at:
---

# インシデントレポート — IN-20250310-001

<!-- markdownlint-disable MD013 -->

- [テンプレート ←](INCIDENT_TEMPLATE.md)
- [RUNBOOK](../Day8/workflow-cookbook/RUNBOOK.md)
- [BLUEPRINT](../Day8/workflow-cookbook/BLUEPRINT.md)
- [EVALUATION](../Day8/workflow-cookbook/EVALUATION.md)

## メタデータ

- 発生日: 2025-03-10
- 対応責任者: oncall-naito
- ステータス: 調査中
- 関連PR/Issue: 起票予定 (#TBD)
- 参照セクション: Runbook「Observability-03」、
  Evaluation「Acceptance Criteria #1」

## 検知 (Detection)

- 14:15 UTC、Nightly ビルド用の `node:test` ジョブが失敗し、
  CI で `prompt-registry checksum mismatch` アラートが発火。
- GitHub Actions の通知が Slack `#alerts` へ転送され、
  オンコールが `runs/latest/ci.log` と Vite のビルドログを取得。
- Datadog の `imgponic.prompt_registry.sync_error` メトリクスが 12/min へ急増。

## 影響 (Impact)

- 影響範囲: Nightly ビルドと自動配布が停止。開発者向けの最新レシピが更新されない。
- 期間: 14:15 UTC から継続中（再配布完了まで想定 2 時間）。
- 影響度: Minor — 本番影響は無いが、翌朝の検証リハーサルに遅延が生じる可能性。

## 5 Whys (Root Cause)

1. なぜ Nightly ビルドが失敗したか？ → レシピ同期フェーズでチェックサム差異が検出され、
   ジョブが自動停止した。
2. なぜチェックサム差異が起きたか？ → `data/recipes/system.sora2.yaml` の整形スクリプトが
   PR #238 の後で更新されず、整形結果がずれた。
3. なぜ整形スクリプト更新が漏れたか？ → Blueprint の「Minimal Flow」で想定する
   `Format → Validate` の順序が CI 定義に反映されていなかった。
4. なぜ CI 定義に反映されていなかったか？ → Evaluation の Acceptance Criteria #1 に
   整形スクリプト実行ログの添付が必須と明記されておらず、レビューで見落とした。
5. なぜ基準が更新されていなかったか？ → 過去インシデント (IN-20250215-001) の
   フォローアップで Evaluation 更新タスクが backlog に残っていた。

## 再発防止策 (Preventive Actions)

- [ ] `scripts/format-recipe.ts` を PR #TBD で修正し、
  CI で整形→検証の順序を明示（担当: build-yamada / 2025-03-12）。
- [ ] `.github/workflows/nightly.yml` にチェックサム差異検出時の
  自動ロールバック処理を追加（担当: sre-hori / 2025-03-14）。
- [ ] `Day8/workflow-cookbook/EVALUATION.md` の Acceptance Criteria #1 へ
  整形スクリプト実行ログ添付を追記（担当: qa-kimura / 2025-03-11）。
- [ ] Blueprint の Minimal Flow 図に整形ステップの CI 実装リンクを追記
  （担当: docs-takahashi / 2025-03-15）。

## タイムライン (Timeline)

| 時刻 (UTC/JST) | イベント | 詳細/担当 |
| --- | --- | --- |
| 14:15 / 23:15 | CI 失敗を検知 | GitHub Actions→Slack #alerts 通知（oncall-naito） |
| 14:25 / 23:25 | 初動確認 | Runbook手順でログ収集と差異ファイル特定 |
| 14:40 / 23:40 | 暫定対応 | Nightly配布を停止し前日レシピを手動復旧 |
| 15:05 / 00:05 | 根本分析 | Blueprint Minimal Flow と CI 定義の差異をレビュー |
| 15:30 / 00:30 | 恒久対策合意 | Evaluation更新タスクを再優先付けしPR担当を決定 |

---

- フォローアップ: Preventive Actions 完了後、Blueprint と Evaluation の該当節に
  本インシデントIDを記録し、追跡 Issue を README の運用フローへ反映する。
- 参照: Runbook「Observability-03」の手順書および
  Evaluation「Acceptance Criteria #1」。

<!-- markdownlint-enable MD013 -->
