---
incident_id: IN-20250215-001
status: draft
severity: major
detected_at: 2025-02-15T00:02:00Z
resolved_at: 2025-02-15T01:25:00Z
---

# インシデントレポート — IN-20250215-001

[← RUNBOOK](../Day8/workflow-cookbook/RUNBOOK.md) | [テンプレート](INCIDENT_TEMPLATE.md) | [EVALUATION →](../Day8/workflow-cookbook/EVALUATION.md)

## メタデータ
- 発生日: 2025-02-15
- 対応責任者: oncall-sato
- ステータス: 再発防止策実行中
- 関連PR/Issue: #241 (緊急fix), TASK.OPS-02-20250215

## 検知 (Detection)
- 00:02 UTC、合成レシピのバッチ処理が `HTTP 429` を連発し、Grafana アラート `ollama_batch_rate_limit` が発火。
- Slack `#alerts` へ通知後、オンコールが Runbook 「Observability」の手順でログを収集。
- Ollama API メトリクス（RateLimitUsage > 95%）と Tauri 側の `error.log` を突合。

## 影響 (Impact)
- 影響範囲: `runs/` でのバッチ生成機能が停止、手動実行も失敗。
- 期間: 00:02–01:25 UTC（83 分間）
- 影響度: Major — 開発チーム5名が夜間検証を実施できず、翌日の検証計画が1日遅延。

## 5 Whys (Root Cause)
1. なぜバッチが失敗したか？ → Ollama API のレート制限に到達し、全リクエストが 429 で失敗。
2. なぜレート制限に到達したか？ → 直前のレシピ更新で並列度を 8→16 に引き上げたが、制限値を再計算していなかった。
3. なぜ制限値の再計算がされなかったか？ → 変更レビューで `capacity_budget.md` を参照するチェックが抜けていた。
4. なぜチェックが抜けたか？ → PR テンプレートの Incident セクションに「並列度変更時の容量確認」項目が存在しなかった。
5. なぜテンプレートに項目が無かったか？ → 過去のインシデント整理（IN-20241201-002）が CHANGELOG のみで共有され、テンプレートへの反映が漏れた。

## 再発防止策 (Preventive Actions)
- [x] 並列度を即時に 8 へロールバックし、Ollama レート制限を解除（PR #241）。
- [ ] `docs/capacity_budget.md` を更新し、並列度ごとの消費枠を明示（担当: capacity-lead / 2025-02-20）。
- [ ] `.github/PULL_REQUEST_TEMPLATE.md` に「並列度変更時は容量計算を添付」チェックを追加（担当: qa-kimura / 2025-02-18）。
- [ ] Grafana に `rate_limit_buffer < 10%` の事前警告アラートを追加（担当: sre-hori / 2025-02-22）。

## タイムライン (Timeline)
| 時刻 (UTC/JST) | イベント | 詳細/担当 |
| --- | --- | --- |
| 00:02 / 09:02 | アラート検知 | Grafana → Slack `#alerts`（オンコール: oncall-sato） |
| 00:10 / 09:10 | 初動確認 | Runbook に沿ってログ採取、RateLimit Usage 95% を確認 |
| 00:25 / 09:25 | 暫定対応 | 並列度を 8 へロールバックし、15 分でエラー率 0% を確認 |
| 00:40 / 09:40 | 根本調査 | capacity-lead が過去の容量計算を再確認、欠落チェックを特定 |
| 01:10 / 10:10 | 恒久対策合意 | QA/SRE/Apps チームで PR テンプレ修正と新アラートを合意 |
| 01:25 / 10:25 | 監視閉域 | 429 が 0 に戻り、アラート自動クローズ |

---

- フォローアップ: Preventive Actions を完了後、README「インシデント対応フロー」の運用例を更新する。
- 参照: `Day8/workflow-cookbook/EVALUATION.md` の Acceptance Criteria に基づき、再発防止策の Issue を QA がモニタリング。
